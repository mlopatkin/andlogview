name: PR Tests for Github
on:
  pull_request:
    branches:
      - master
      - release/*
jobs:
  run-precommit-tests:
    runs-on: ubuntu-latest
    container: ghcr.io/mlopatkin/andlogview-build-environment@sha256:b6d32e5bcf3e74d1a1f29b712ee53f6858398fa71a2c89eca249b0053d72229a
    env:
      PYTHON_BINARY: python3
    steps:
      - uses: actions/checkout@v2
      - name: Run lint checks
        run: bash tools/hooks/lint-all.sh
      - name: Run unit tests
        # Do not use Gradle Daemon because we only have a single invocation.
        uses: gradle/gradle-build-action@356abb47e7664b5505e25d7997a5a522a17c62d9
        with:
          arguments: |
            -Dorg.gradle.internal.launcher.welcomeMessageEnabled=false
            -Porg.gradle.java.installations.fromEnv=JDK8,JDK17
            -Porg.gradle.java.installations.auto-download=false
            --no-daemon
            --stacktrace
            --continue
            check
            shadowDistZip
      - name: Publish artifacts
        uses: ./.github/actions/publish-gradle-outputs
